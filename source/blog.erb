<div class="page-header">
  <div class="page-header__container">
    <div class="page-header__title">
      Blog
    </div>
  </div>
</div>

<div class="container container--blog" id="siteHeaderWaypoint" data-packery-target>
  <% blog.articles.each do |article| %>
    <% if article.data.weekly_roundup %>
      <%= partial 'blog_small_tile', locals: { article: article } %>
    <% elsif article.data.main_image %>
      <%= partial 'blog_large_tile', locals: { article: article } %>
    <% else %>
      <%= partial 'blog_medium_tile', locals: { article: article } %>
    <% end %>
  <% end %>
</div>

<script>
  var $packeryContainer = $('[data-packery-target]');
  var packeryOptions = {
    transitionDuration: 0,
    percentPosition: true,
    itemSelector: '.blog-tile',
    columnWidth: '.blog-small-tile'
  };

  if (Modernizr.matchmedia) {
    var mq = matchMedia('(min-width: 660px)');

    if (mq.matches) {
      $packeryContainer.packery(packeryOptions);
    }

    mq.addListener(function(mql) {
      if (mql.matches) {
        $packeryContainer.packery(packeryOptions);
      } else {
        $packeryContainer.packery('destroy');
      }
    });
  }

  new Waypoint({
    element: $('#siteHeaderWaypoint'),
    handler: function(direction) {
      var siteHeader = $('.site-header');
      if (direction === 'down') {
        siteHeader.addClass('site-header--active-scroll');
      } else {
        siteHeader.removeClass('site-header--active-scroll');
      }
    },
    offset: 54
  });

</script>

<!--[if IE 9]>
  <script>

    var packeryEnabled = false;

    $(window).resize(function() {
      if (window.innerWidth >= 660 && !packeryEnabled) {
        $packeryContainer.packery(packeryOptions);
        packeryEnabled = true;
      } else if (window.innerWidth < 660 && packeryEnabled) {
        $packeryContainer.packery('destroy');
        packeryEnabled = false;
      }
    });

  </script>
<![endif]-->


